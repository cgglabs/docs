"use strict";(self.webpackChunkcgg_labs_docs=self.webpackChunkcgg_labs_docs||[]).push([[511],{7474:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>d});var r=i(3301),o=i(4848),t=i(8453);const s={slug:"rp2040-freertos",title:"Adding FreeRTOS to an RP2040 Project",authors:"carlos",image:"/img/freertos_blog_post.png",tags:["RP2040","FreeRTOS"]},l="Adding FreeRTOS to an RP2040 Project in VSCode",c={authorsImageUrls:[void 0]},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step-by-Step Instructions",id:"step-by-step-instructions",level:2},{value:"1. Download FreeRTOS",id:"1-download-freertos",level:3},{value:"2. Copy FreeRTOS Files to Your Project",id:"2-copy-freertos-files-to-your-project",level:3},{value:"3. Add FreeRTOS Configuration File",id:"3-add-freertos-configuration-file",level:3},{value:"4. Update CMakeLists.txt",id:"4-update-cmakeliststxt",level:3},{value:"5. (optional) Implement Stack Overflow Hook",id:"5-optional-implement-stack-overflow-hook",level:3},{value:"6. Write FreeRTOS Code",id:"6-write-freertos-code",level:3},{value:"7. Configure VSCode Build",id:"7-configure-vscode-build",level:3},{value:"8. Build and Flash",id:"8-build-and-flash",level:3},{value:"9. Test the Project",id:"9-test-the-project",level:3},{value:"Notes",id:"notes",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["We at CGG Labs love the RP2040 ","\u2764\ufe0f"]}),"\n",(0,o.jsx)(n.p,{children:"Here's how to use it with FreeRTOS to unlock the power of full preemptive scheduling."}),"\n",(0,o.jsxs)(n.p,{children:["Or you can use our ",(0,o.jsx)(n.a,{href:"https://github.com/cgglabs/Pico-FreeRTOS",children:"template"})," and get on with building."]}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Pico SDK"}),": Installed and configured."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"VSCode"}),": Equipped with ",(0,o.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=ms-vscode.cmake-tools",children:"CMake Tools"})," and ",(0,o.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools",children:"C/C++"})," extensions."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"RP2040 Project"}),": A working project set up in VSCode with the Pico SDK."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Git"}),": Installed for cloning FreeRTOS."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"step-by-step-instructions",children:"Step-by-Step Instructions"}),"\n",(0,o.jsx)(n.h3,{id:"1-download-freertos",children:"1. Download FreeRTOS"}),"\n",(0,o.jsx)(n.p,{children:"Clone the FreeRTOS repository or download a release:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/FreeRTOS/FreeRTOS.git --recurse-submodules\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Alternatively, grab a zip from ",(0,o.jsx)(n.a,{href:"https://github.com/FreeRTOS/FreeRTOS/releases",children:"FreeRTOS GitHub releases"})," and extract it."]}),"\n",(0,o.jsx)(n.h3,{id:"2-copy-freertos-files-to-your-project",children:"2. Copy FreeRTOS Files to Your Project"}),"\n",(0,o.jsx)(n.p,{children:"Organize FreeRTOS files in your project:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Create a ",(0,o.jsx)(n.code,{children:"FreeRTOS"})," directory in your project root."]}),"\n",(0,o.jsxs)(n.li,{children:["Copy the following from the FreeRTOS repository to ",(0,o.jsx)(n.code,{children:"FreeRTOS"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"FreeRTOS/Source"})," (core files)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"FreeRTOS/Source/portable/GCC/ARM_CM0"})," (Cortex-M0 port for RP2040)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"FreeRTOS/Source/portable/MemMang/heap_4.c"})," (heap_4 is a common memory manager; others like ",(0,o.jsx)(n.code,{children:"heap_1.c"})," can also be used)."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Copy ",(0,o.jsx)(n.code,{children:"FreeRTOS/Source/include"})," to ",(0,o.jsx)(n.code,{children:"FreeRTOS/include"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"3-add-freertos-configuration-file",children:"3. Add FreeRTOS Configuration File"}),"\n",(0,o.jsxs)(n.p,{children:["Create ",(0,o.jsx)(n.code,{children:"FreeRTOSConfig.h"})," in the ",(0,o.jsx)(n.code,{children:"FreeRTOS/include"})," directory with a minimal configuration:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-c",children:"#ifndef FREERTOS_CONFIG_H\n#define FREERTOS_CONFIG_H\n\n#define configUSE_PREEMPTION 1\n#define configUSE_IDLE_HOOK 0\n#define configUSE_TICK_HOOK 0\n#define configCPU_CLOCK_HZ 125000000 // 125MHz\n#define configTICK_RATE_HZ ((TickType_t)1000) // 1ms tick\n#define configMAX_PRIORITIES (5)\n#define configMINIMAL_STACK_SIZE ((uint16_t)128)\n#define configTOTAL_HEAP_SIZE ((size_t)(10 * 1024)) // 10KB heap\n#define configMAX_TASK_NAME_LEN (16)\n#define configUSE_16_BIT_TICKS 0\n#define configIDLE_SHOULD_YIELD 1\n#define configUSE_MUTEXES 1\n#define configQUEUE_REGISTRY_SIZE 8\n\n/* Memory allocation definitions */\n#define configSUPPORT_DYNAMIC_ALLOCATION 1\n#define configSUPPORT_STATIC_ALLOCATION 0\n\n/* Interrupt priorities */\n#define configKERNEL_INTERRUPT_PRIORITY 255\n#define configMAX_SYSCALL_INTERRUPT_PRIORITY 191\n\n/* Map to Pico SDK */\n#define configUSE_TIMERS 1\n#define configTIMER_TASK_PRIORITY (configMAX_PRIORITIES - 1)\n#define configTIMER_QUEUE_LENGTH 10\n#define configTIMER_TASK_STACK_DEPTH configMINIMAL_STACK_SIZE\n\n#define configENABLE_MPU 0\n\n/* Set the following INCLUDE_* constants to 1 to include the named API function,\n * or 0 to exclude the named API function.  Most linkers will remove unused\n * functions even when the constant is 1. */\n#define INCLUDE_vTaskPrioritySet               1\n#define INCLUDE_uxTaskPriorityGet              1\n#define INCLUDE_vTaskDelete                    1\n#define INCLUDE_vTaskSuspend                   1\n#define INCLUDE_vTaskDelayUntil                1\n#define INCLUDE_vTaskDelay                     1\n#define INCLUDE_xTaskGetSchedulerState         1\n#define INCLUDE_xTaskGetCurrentTaskHandle      1\n#define INCLUDE_uxTaskGetStackHighWaterMark    0\n#define INCLUDE_xTaskGetIdleTaskHandle         0\n#define INCLUDE_eTaskGetState                  0\n#define INCLUDE_xTimerPendFunctionCall         0\n#define INCLUDE_xTaskAbortDelay                0\n#define INCLUDE_xTaskGetHandle                 0\n#define INCLUDE_xTaskResumeFromISR             1\n\n#endif /* FREERTOS_CONFIG_H */\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Customize ",(0,o.jsx)(n.code,{children:"configTOTAL_HEAP_SIZE"}),", ",(0,o.jsx)(n.code,{children:"configMAX_PRIORITIES"}),", etc., based on your project needs."]}),"\n",(0,o.jsx)(n.h3,{id:"4-update-cmakeliststxt",children:"4. Update CMakeLists.txt"}),"\n",(0,o.jsxs)(n.p,{children:["Modify your ",(0,o.jsx)(n.code,{children:"CMakeLists.txt"})," to include FreeRTOS:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-cmake",children:"# Add FreeRTOS as a library\nadd_library(freertos\n    FreeRTOS/Source/croutine.c\n    FreeRTOS/Source/event_groups.c\n    FreeRTOS/Source/list.c\n    FreeRTOS/Source/queue.c\n    FreeRTOS/Source/stream_buffer.c\n    FreeRTOS/Source/tasks.c\n    FreeRTOS/Source/timers.c\n    FreeRTOS/Source/portable/GCC/ARM_CM0/port.c\n    FreeRTOS/Source/portable/GCC/ARM_CM0/portasm.c\n    FreeRTOS/Source/portable/GCC/ARM_CM0/mpu_wrappers_v2_asm.c\n    FreeRTOS/Source/portable/MemMang/heap_4.c\n)\n\n# Include FreeRTOS headers\ntarget_include_directories(freertos PUBLIC\n    ${CMAKE_CURRENT_LIST_DIR}/FreeRTOS/include\n    ${CMAKE_CURRENT_LIST_DIR}/FreeRTOS/Source/portable/GCC/ARM_CM0\n    ${CMAKE_CURRENT_LIST_DIR}/FreeRTOS\n)\n\n# Link FreeRTOS to your executable\ntarget_link_libraries(your_executable_name PRIVATE\n    pico_stdlib\n    freertos\n)\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Replace ",(0,o.jsx)(n.code,{children:"your_executable_name"})," with your target's name (from ",(0,o.jsx)(n.code,{children:"add_executable"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:["Ensure ",(0,o.jsx)(n.code,{children:"pico_stdlib"})," is included for Pico SDK functionality."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"5-optional-implement-stack-overflow-hook",children:"5. (optional) Implement Stack Overflow Hook"}),"\n",(0,o.jsxs)(n.p,{children:["If ",(0,o.jsx)(n.code,{children:"configCHECK_FOR_STACK_OVERFLOW"})," is enabled, add the hook in your main C file or a utilities file:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-c",children:"void vApplicationStackOverflowHook(TaskHandle_t pxTask, char *pcTaskName) {\n    (void)pxTask;\n    (void)pcTaskName;\n    while (1) {\n        // Handle stack overflow (e.g., log error, blink LED, or halt)\n    }\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"6-write-freertos-code",children:"6. Write FreeRTOS Code"}),"\n",(0,o.jsx)(n.p,{children:"Include FreeRTOS in your main file and create a sample task:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-c",children:'#include "pico/stdlib.h"\n#include <FreeRTOS.h>\n#include <task.h>\n\n#define LED_PIN 25\n\nvoid vTaskExample(void *pvParameters) {\n    // Initialize LED pin\n    gpio_init(LED_PIN);\n    gpio_set_dir(LED_PIN, GPIO_OUT);\n\n    while (1) {\n        gpio_put(LED_PIN, 1);           // Turn LED on\n        vTaskDelay(pdMS_TO_TICKS(500)); // On for 500ms\n        gpio_put(LED_PIN, 0);           // Turn LED off\n        vTaskDelay(pdMS_TO_TICKS(500)); // Off for 500ms\n    }\n}\n\nint main() {\n    // Initialize Pico SDK\n    stdio_init_all();\n\n    // Create task\n    xTaskCreate(vTaskExample, "ExampleTask", 256, NULL, 1, NULL);\n\n    // Start scheduler\n    vTaskStartScheduler();\n\n    // Should never reach here\n    while (1);\n}\n\n'})}),"\n",(0,o.jsx)(n.h3,{id:"7-configure-vscode-build",children:"7. Configure VSCode Build"}),"\n",(0,o.jsx)(n.p,{children:"Set up VSCode to build with the Pico SDK toolchain:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Use the CMake Tools extension."}),"\n",(0,o.jsxs)(n.li,{children:["Open the Command Palette (",(0,o.jsx)(n.code,{children:"Ctrl+Shift+P"}),"), select ",(0,o.jsx)(n.strong,{children:"CMake: Configure"}),"."]}),"\n",(0,o.jsx)(n.li,{children:"Choose your kit (e.g., Pico SDK toolchain)."}),"\n",(0,o.jsxs)(n.li,{children:["Build the project (",(0,o.jsx)(n.strong,{children:"CMake: Build"})," or ",(0,o.jsx)(n.code,{children:"F7"}),")."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"8-build-and-flash",children:"8. Build and Flash"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Build the project in VSCode."}),"\n",(0,o.jsxs)(n.li,{children:["Flash the ",(0,o.jsx)(n.code,{children:".uf2"})," file to your RP2040 (drag to the USB drive in BOOTSEL mode)."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"9-test-the-project",children:"9. Test the Project"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Connect a terminal (e.g., PuTTY or ",(0,o.jsx)(n.code,{children:"minicom"}),") to the RP2040's UART (default: USB CDC)."]}),"\n",(0,o.jsx)(n.li,{children:'Confirm the task prints "Task running" every second.'}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Heap Size"}),": Tune ",(0,o.jsx)(n.code,{children:"configTOTAL_HEAP_SIZE"})," (RP2040 has 264KB SRAM)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Stack Size"}),": Set task stack sizes (e.g., 256 in ",(0,o.jsx)(n.code,{children:"xTaskCreate"}),") to avoid overflows."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsx)(n.p,{children:"If you encounter linker errors or crashes:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Verify ",(0,o.jsx)(n.code,{children:"CMakeLists.txt"})," paths."]}),"\n",(0,o.jsxs)(n.li,{children:["Check ",(0,o.jsx)(n.code,{children:"FreeRTOSConfig.h"})," settings."]}),"\n",(0,o.jsx)(n.li,{children:"Adjust stack and heap sizes."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>l});var r=i(6540);const o={},t=r.createContext(o);function s(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(t.Provider,{value:n},e.children)}},3301:e=>{e.exports=JSON.parse('{"permalink":"/blog/rp2040-freertos","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-04-12-adding-freertos-to-an-rp2040-project.md","source":"@site/blog/2025-04-12-adding-freertos-to-an-rp2040-project.md","title":"Adding FreeRTOS to an RP2040 Project","description":"We at CGG Labs love the RP2040","date":"2025-04-12T00:00:00.000Z","tags":[{"inline":false,"label":"RP2040","permalink":"/blog/tags/rp2040","description":"RP2040 tag description"},{"inline":false,"label":"FreeRTOS","permalink":"/blog/tags/freertos","description":"FreeRTOS tag description"}],"readingTime":3.755,"hasTruncateMarker":true,"authors":[{"name":"Carlos Gonzalez","title":"Chief Hacker @ CGG Labs","url":"https://cggonzalez.com/","page":{"permalink":"/blog/authors/carlos"},"socials":{"x":"https://x.com/_carlosgonzal","github":"https://github.com/cggonzal"},"imageURL":"/img/cgg.jpeg","key":"carlos"}],"frontMatter":{"slug":"rp2040-freertos","title":"Adding FreeRTOS to an RP2040 Project","authors":"carlos","image":"/img/freertos_blog_post.png","tags":["RP2040","FreeRTOS"]},"unlisted":false,"nextItem":{"title":"Welcome","permalink":"/blog/welcome"}}')}}]);